# fenya-store

## Работа с монорепозиторием

Мы используем [npm workspaces](https://docs.npmjs.com/cli/v7/using-npm/workspaces). Прежде чем изменять зависимости ознакомьтесь с документацией.
У нас есть два воркспейса:
- client
- server

### Начало работы

После клонирования репозитория запустите следующую команду из корня проекта:

```
npm install
```

### Установка пакета для конкретного воркспейса

Чтобы установить пакет для использования в конкретном воркспейсе используйте команду
```
npm i $DEPENDENCY_NAME$ -w $WORKSPACE_NAME$
```
где:
- `$DEPENDENCY_NAME$` - название npm-пакета
- `$WORKSPACE_NAME$` - название воркспейса (client или server)

Важно запускать эту команду, находясь в корне проекта.


## Разработка

Для запуска сервера разработки бекэнда из корня используйте команду:

```
npm run start:server
```

Для запуска сервера разработки фронтэнда используйте из корня:

```
npm run start:client
```

## Отправка изменений

Мы больше не используем git-hooks. Форматирование кода происходит автоматически при создании PR (pull request) в `main` или `dev` с помощью [github actions](https://docs.github.com/en/actions). То есть вы можете отправлять код в любом формате, он будет отформатирован автоматически.

## Миграция со старой конфигурации репозитория

У вас есть несколько вариантов:

### У вас нет локальных изменений, которые нужно сохранить

В этом случае вы можете просто удалить репозиторий и склонировать его и заново и следовать инструкции в [Начало работы](#Начало_работы).

### у вас есть локальные изменения, которые нужно сохранить

1. Добейтесь "чистой" рабочей директории, то есть сделайте коммиты (или уберите в stash) все измененные файлы на своей ветке.
2. Переключитесь на ветку `dev` (`git switch dev`)
3. Подтяните актуальную версию (`git pull`)
4. Удалите следующие директории
    - `client/node_modules`
    - `server/node_modules`
5. Запустите из корня проекта `npm i`
6. Проверьте, что приложения запускаются:
    - `npm run start:client`
    - `npm run start:server`
7. Вернитесь на свою ветку (`git switch НАЗВАНИЕ ВАШЕЙ ВЕТКИ`)
8. Тут у вас два (+ 1 неправильный) варианта
    - `git rebase dev` (скорее всего у вас будет много конфликтов)
    - вмержить в вашу ветку dev (`git merge dev`) - у вас тоже будет много конфликтов
    - забить на старую ветку (создайте новую от `dev`) и переносить изменения вручную (вы избежите конфликтов, но тоже устанете)
